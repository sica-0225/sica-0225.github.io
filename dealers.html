<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>經銷商據點 - WEBSITE</title>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M3PJB5T6');</script>
<!-- End Google Tag Manager -->

<!-- 引用全域樣式表 -->
<link rel="stylesheet" href="style.css">
<!-- 引用此頁專屬樣式表 -->
<link rel="stylesheet" href="dealers.css">

<!-- Leaflet.js 的 CSS 和 JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M3PJB5T6"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- 統一的頁首 -->
<header>
    <a href="index.html" class="logo">WEBSITE</a>
    <nav>
        <a href="index.html#section1">Model S</a>
        <a href="index.html#section2">Model 3</a>
        <a href="index.html#section3">Model X</a>
        <a href="index.html#section4">Model Y</a>
        <a href="dealers.html">經銷商據點</a>
    </nav>
    <div class="header-actions">
        <a href="order.html" class="btn-secondary">線上訂購</a>
    </div>
</header>

<main>
    <div class="page-wrapper">
        <div id="panel">
            <!-- 這裡的內容會由 JavaScript 動態生成 -->
        </div>
        <div id="map"></div>
    </div>
</main>

<!-- 您的 JavaScript 邏輯完全不需要修改，可以直接沿用 -->
<script>
    // 1. 經銷商資料庫
    const dealers = [
        { id: 'TP01', name: '台北九和汽車-南港/忠孝服務廠', address: '台北市南港區忠孝東路六段297號', latlng: [25.049, 121.605] },
        { id: 'HS01', name: '新竹科學園區店', address: '新竹市東區工業東二路1號', latlng: [24.774, 120.995] },
        { id: 'TC01', name: '台中七期店', address: '台中市西屯區市政路1號', latlng: [24.163, 120.640] }
    ];

    // 2. 初始化地圖
    const map = L.map('map').setView([24.8, 121.1], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const panel = document.getElementById('panel');
    let markers = {};

    // 3. 顯示經銷商列表
    function showDealerList() {
        let listHtml = `
            <div class="panel-header"><h1>經銷商據點</h1></div>
            <ul class="dealer-list">`;
        
        dealers.forEach(dealer => {
            listHtml += `
                <li class="dealer-list-item" data-id="${dealer.id}">
                    <h2>${dealer.name}</h2>
                    <p>${dealer.address}</p>
                </li>`;
        });
        listHtml += '</ul>';
        panel.innerHTML = listHtml;
    }

    // 4. 顯示單一經銷商的詳細資訊
    function showDealerInfo(dealerId) {
        const dealer = dealers.find(d => d.id === dealerId);
        if (!dealer) return;

        const infoHtml = `
            <div class="dealer-info-card">
                <p class="back-to-list">&lt; 返回列表</p>
                <h2>${dealer.name}</h2>
                <p><strong>地址：</strong> ${dealer.address}</p>
                <p><strong>電話：</strong> 02-2785-0571</p>
                <p><strong>營業時間：</strong> 週一至週六 07:30 - 17:30</p>
                <button class="btn-test-drive" data-dealer-id="${dealer.id}" data-dealer-name="${dealer.name}">預約試駕</button>
            </div>`;
        panel.innerHTML = infoHtml;

        map.setView(dealer.latlng, 15);
        if (markers[dealer.id]) {
            // 這裡可以加上更酷炫的標記互動效果，但目前維持原樣
        }
    }

    // 5. 建立地圖標記
    dealers.forEach(dealer => {
        const marker = L.marker(dealer.latlng).addTo(map);
        marker.on('click', () => {
            showDealerInfo(dealer.id);
        });
        markers[dealer.id] = marker;
    });

    // 6. 設定事件監聽
    panel.addEventListener('click', function(event) {
        const listItem = event.target.closest('.dealer-list-item');
        if (listItem) {
            showDealerInfo(listItem.dataset.id);
            return;
        }

        if (event.target.classList.contains('back-to-list')) {
            showDealerList();
            map.setView([24.8, 121.1], 8);
            return;
        }

        const testDriveButton = event.target.closest('.btn-test-drive');
        if (testDriveButton) {
            const dealerId = testDriveButton.dataset.dealerId;
            const dealerName = testDriveButton.dataset.dealerName;

            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'book_test_drive',
                'dealer_id': dealerId,
                'dealer_name': dealerName
            });

            alert('預約 ' + dealerName + ' 的事件已記錄！');
        }
    });

    // 初始載入時顯示列表
    showDealerList();
</script>

</body>
</html>
